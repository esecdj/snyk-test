name: import sync

on:
  push:
    branches: [ main ]

jobs:
  sync-import:
    runs-on: ubuntu-latest
    name: download api import
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      CONCURRENT_IMPORTS: ${{ secrets.CONCURRENT_IMPORTS }}
      SNYK_LOG_PATH: ${{ secrets.SNYK_LOG_PATH }}
    steps:
    
    - name: Checkout
      uses: actions/checkout@v5
      with:
          ref: main
          
    - name: Download Snyk Import
      run: |
         wget -q -O snyk-api-import https://github.com/snyk/snyk-api-import/releases/download/v2.21.6/snyk-api-import-linux
         chmod a+x ./snyk-api-import
         mv ./snyk-api-import /usr/local/bin/
         mkdir -p /usr/local/bin/snyk/log
         chmod -R 777 /usr/local/bin/snyk/log
         
    - name: Run Snyk Import
      run: |
         echo ${{ github.event.repository.name }}
         echo ${{ github.event.repository.owner.name }}
         DEBUG=snyk* snyk-api-import import --file=import-projects.json
